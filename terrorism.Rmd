```{r include = FALSE}
## This markdown file is mainly meant to serve as an HTML report to visualize the results
## of all the scripts in one place.  To get a better understanding of how the code works,
## look at the actual scripts available on Github https://github.com/daattali/statsTerrorismProject

opts_chunk$set(tidy = FALSE)
source('common.R')
library(xtable)
library(maps)
library(mapdata)
data(world.cities)
library(fBasics)

printTable <- function(x) {
  x <- xtable(x)
  print(x, type = 'html', include.rowname = FALSE)
}
```

Analysis of Global Terrorism Activity
==============================
_Dean Attali  
October 2013  
UBC STAT545A Final Project_

**All the data and code required to create this report are available on [GitHub](https://github.com/daattali/statsTerrorismProject)**

#### Summary

In this project, I explored a dataset containing information about global terrorism acts since 1970, and attempted to make the findings as visual as possible.  The dataset used is called the Global Terrorism Database ([available here](http://www.start.umd.edu/gtd/)), and contains over 100,000 terrorist incidents worldwide, with over 100 different attributes for each incident.  Most of the analysis is done globally, but one of the scripts focuses on terrorism in Israel since it is very relevant to me.

While there are dozens of interesting ideas to explore within the dataset, I had to choose only a small subset of them to implement. There is much more that can be done with this database. In order to simplify and make the analysis much more efficient, I chose to discard over 100 attributes, and only retain a few of the key variables such as date, attack type, location, and casualties.  It should also be noted that all information from 1993 is missing from this database as a result of human error (more information is available [here](http://www.start.umd.edu/gtd/faq/#q9)).

This report focuses on displaying and anlyzing the results, but de-emphasizes the underlying process and code. Numerous hours were spent on getting this done, including several all-night coding sessions that ended after the birds got up. To get a better understanding of how the data was manipulated and how all the scripts work, feel free to look at the [Git repository for this project](https://github.com/daattali/statsTerrorismProject).  You can also download the raw data and code to run the analysis from there.

#### Global Terrorism

Let's start with a very basic, yet upsetting, statistic in the data: the number of people wounded and killed by each attack type overall

```{r fig.width=9, fig.height=6, fig.align='center', echo=FALSE}
attacktypeDamage <- ddply(dat, ~attacktype, function(x){
  df <- data.frame(c("nkill", "nwound"), c(sum(x$nkill), sum(x$nwound)));
  colnames(df)<-c("stat","value");
  return(df)
})

ggplot(attacktypeDamage, aes(x = attacktype, y = value, fill = stat)) +
  geom_bar(stat = "identity", position = position_dodge(width=0.9)) +
  coord_flip() +
  ggtitle("Number of People Wounded or Killed by Terrorist Attacks Since 1970") +
  xlab("") +
  ylab("# of People") +
  scale_fill_manual(name = "Injury Type", values = c("black", "red"), labels = c('Killed', 'Wounded')) +
  guides(fill = guide_legend(reverse = TRUE)) +
  theme(panel.grid.major.y = element_blank(),
        plot.title = element_text(face="bold"))
```

It is immediately visible that bombings and armed assaults are the attacks that have killed and injured the most people.  With bombings, there are far more people getting injured than killed, while with armed assault the fatalities are the highest.

---

Now let's look at some region-level statistics.  
Let's get a quick overview of the regions, and see how many attacks happened in each 

```{r fig.width=9, fig.height=7, fig.align='center', echo=FALSE}
regionTotal <- ddply(dat, ~region, plyrFxCount)
ggplot(regionTotal, aes(x = region, y = count, fill = region)) +
  geom_bar(stat="identity", show_guide=FALSE) +
  coord_flip() +
  ggtitle("Terrorist Attacks in World Regions Since 1970") +
  xlab("") +
  ylab("# of Attacks") +
  scale_fill_manual(values = regionCol) +
  theme(panel.grid.major.y = element_blank(),
        plot.title = element_text(face="bold"))
```

It looks like overall since 1970, there hasn't been one major region that suffered more than others. Every successvie region has less terror attacks than its previous, but the gap is never massive.

---

Next we will zoom in and see what happens when we look at different years rather than combined history.

```{r fig.width=11, fig.height=8, fig.align='center', echo=FALSE}
# calculate the number of attacks in each region per year
regionYear <- ddply(dat, region ~ year, plyrFxCount, "nattacks")

# fix a little "problem" (well, a good problem), where some regions have years with 0 attacks
# this will cause some missing points in the plots which doesn't look nice, so we will
# just add a value of 0 for every region/year pair that doesn't exist
regionYearPossibilities <- merge(regions, unique(dat$year))
regionYear <- merge(regionYear, regionYearPossibilities,
                    by.x = c('region','year'), by.y = c("x","y"), all.y = TRUE)
regionYear$nattacks[is.na(regionYear$nattacks)] <- 0

# let's look at the number of attacks per year in each world region
ggplot(regionYear, aes(x = year, y = nattacks, color = region)) +
  geom_line(show_guide=FALSE) +
  geom_point(show_guide=FALSE) +
  xlab("Year") + 
  ggtitle("Number of Terrorist Attacks in World Regions Since 1970") + 
  ylab("# of Attacks") +
  facet_wrap(~region) +
  scale_color_manual(values = regionCol) + 
  theme(strip.text = element_text(face="bold"),
        plot.title = element_text(face="bold"))
```

This already reveals some interesting data.  
Central America seemed to be very unstable starting at the late 1970's and slowly getting better with time, until almost eliminating terrorist attacks before the new millenium.  
The Middle East and South Asia both had a surge of terrorist attacks since circa 2005, after both having "relative" quiet since the mid 90's.  
South America was was consistently pretty dangerous througout the 80's and 90's, and has calmed since.  Western Europe is another region worth mentioning, that had many attacks up until the new millenium.
The rest of the regions are worth glancing at, but are not as interesting.

---

Now let's look at the same plot, but with all the regions superposed

```{r fig.width=11, fig.height=7, fig.align='center', echo=FALSE}
ggplot(regionYear, aes(x = year, y = nattacks, color = region)) +
  geom_line() +
  geom_point() +
  xlab("Year") + 
  ggtitle("Number of Terrorist Attacks in World Regions Since 1970") + 
  ylab("# of Attacks") +
  scale_color_manual(values = regionCol) + 
  theme(legend.justification = c(0,1), legend.position = c(0,1), legend.title = element_blank(),
        plot.title = element_text(face="bold")) +
  guides(col = guide_legend(ncol = 2))
```

While this looks messy and a little harder to read, it is interesting to see global patterns.  
We can see that from the late 70's til the late 90's, many regions experienced higher terror attacks, and by 2000 most have achieved relative peace. Interestingly, the Middle East and South Asia (both of which also seemed to have much lower terrorist activity around the turn of the millenium) have both seen a sharp increase in the past decade.

---

Another way to visualize this data would be to group the years into 5-year buckets, and see the different regions at each time frame.

```{r fig.width=11, fig.height=8, fig.align='center', echo=FALSE}
yearBucketSize <- 5
breaks <- seq(from = min(regionYear$year), to = max(regionYear$year), by = yearBucketSize)
bins <- cut(regionYear$year, breaks = breaks, include.lowest=TRUE, right=FALSE)
regionYear$bin <- bins

# since our buckets are 5-year intervals, data from 2011 did not fit into a bucket and will be discarded
regionYear <- regionYear[complete.cases(regionYear), ]

# now make a new data frame where the data is already grouped into 5-year bins
regionYearBin <- ddply(regionYear, region ~ bin, plyrFxSum, "nattacks", "nattacks")
ggplot(regionYearBin, aes(x = region, y = nattacks, fill = region)) +
  geom_bar(stat = "identity", show_guide=FALSE) +
  facet_wrap(~bin, ncol = 4) +
  ylab("# of Attacks") + 
  ggtitle("Number of Terrorist Attacks in World Regions in 5-Year Intervals Since 1970") + 
  xlab("") +
  coord_flip() +  # to make the bars horizontal so that reading the regions is easier
  scale_fill_manual(values = regionCol) +
  theme(panel.background = element_rect(fill='#EEEEEE'),
        panel.grid.major.y = element_blank(),
        strip.text = element_text(face="bold"),
        plot.title = element_text(face="bold"))
```

From this set of plots it is much clearer what the terrorist activity situation was at different regions at different time periods. Similar patterns emerge (which makes sense because we are looking at the same data), but it's even more clear now how bad South Asia and the Middle East are getting recently, and how Central America has improved drastically since the 1980's.  
We can also see how Oceania and East Asia are the "boring" observations once again, so if you're looking for a safe place, you know where to go.

---

One interesting question that could be asked is whether there is much variation within the different regions, ie. are a few countries the cause of most terrorism in a region. Let's see!

```{r fig.width=10, fig.height=7, fig.align='center', echo=FALSE}
countriesTotal <- ddply(dat, .(country, region), plyrFxCount, "nattacks")
ggplot(countriesTotal, aes(x = nattacks, y = region, color = region, cex = 1.7)) +
  geom_jitter(position = position_jitter(height = 0.4), show_guide=FALSE) +
  ggtitle("Variation in Number of Attacks in Different Countries Within Each Region Since 1970") +
  xlab("# of Attacks") +
  ylab("") +
  scale_color_manual(values = regionCol) +
  theme(panel.grid.minor.x = element_blank(), panel.grid.major.x = element_blank(),
        panel.grid.major.y = element_line(color = "#EEEEEE"),
        panel.background = element_rect(fill = '#FCFCFC', colour = '#D3D3D3'),
        plot.title = element_text(face="bold"))
```

This does indeed show that usually there are just a few countries where most of the terrorism happens, whereas most other countries in the region are safer.

---

It would be interesting to see which countries are the ones that are hit the hardest.  By visual inspection, we can see that there are never more than 5 countries in a region that are extremely worse than the rest, so let's pick out the highest 5 per region. We'll also drop the 3 boring continents to make the resulting table a little bit easier to digest, and there isn't much useful information there.

```{r results='asis', echo=FALSE}
boringRegions <- rev(levels(countriesTotal$region))[1:3]
countriesTotalSubset <- subset(countriesTotal, !(region %in% boringRegions))
topNcountries <- 5
topNcountriesRegion <-
  ddply(countriesTotalSubset, ~region, function(x) {
    x <- arrange(x, -nattacks)
    x <- head(x, n = topNcountries)
    return(x)
  })
# rearrange the columns to have the region first, easier to look at in table format  
topNcountriesRegion <- subset(topNcountriesRegion, select = c("region", "country", "nattacks"))
colnames(topNcountriesRegion) <- c('Region', 'Country', '# Attacks')
printTable(topNcountriesRegion)
```

Ouch. Looks like Iraq is the unlucky country that attracted the most terrorism acts in the world.  
The rest of the Middle East isn't doing amazing, but no one is close to Iraq in that geographic area.  
In South Asia, India and Pakistan, and to a lesser extend Afghanistan and Sri Lanka, are the ones responsible for most of the terrorism.  
Colombia is the terror master of South America, and Peru also got a lot of suffering.  
In Western Europe, it is North Ireland and Spain that sustained most of the damage, while in Central America it is El Salvador.  
In Sub-Saharan Africa, South Africa is the country that has the most terrorism activities.  
The Philippines and Thailand are the two countries most prone to terror attacks in Southeast Asia, while in North America it is the United States.  
Lastly, out of all the Soviet Union countries, Russia seems to be the one that suffered the most from terrorism.

---

Another possibly interesting piece of information to look at is what kinds of terror attacks are most common at each region.

```{r fig.width=11, fig.height=9, fig.align='center', echo=FALSE}
regionAttacktype <- ddply(dat, region ~ attacktype, plyrFxCount)
ggplot(regionAttacktype, aes(x = attacktype, y = count, fill = attacktype)) +
  geom_bar(stat="identity", show_guide=FALSE) +
  facet_wrap(~region) +
  coord_flip() +
  ggtitle("Terrorist Attack Types in World Regions Since 1970") +
  xlab("") +
  ylab("# of Attacks") +
  scale_fill_manual(values = attacktypeCol) +
  theme(panel.grid.major.y = element_blank(),
        strip.text = element_text(face="bold"),
        plot.title = element_text(face="bold"))
```

These plots reveal a few interesting bits of information. Firstly, we can see that almost everywhere in the world bombings are the most common, followed by armed assaults and assassinations. Facility attacks and hostake kidnappings are the next most common attacks, while the rest are are very minimal. It is interesting to note that Central America is the only place where armed assault is more common than bombings, and that in Africa and Southeast Asia there are as many armed assaults as bombings.  
Another observation that stands out is the facility attacks in North America. where it is almost the most common form of terrorism, slightly less than bombings.




#### Terrorism in Israel